<?php/*  Template Name: Crop Image */?><!DOCTYPE html><!--[if IE 7]><html class="ie ie7" <?php language_attributes(); ?>><![endif]--><!--[if IE 8]><html class="ie ie8" <?php language_attributes(); ?>><![endif]--><!--[if !(IE 7) | !(IE 8)  ]><!--><html <?php language_attributes(); ?>>    <!--<![endif]-->    <head>        <meta charset="<?php bloginfo('charset'); ?>" />        <meta name="viewport" content="width=device-width" />        <title><?php wp_title('|', true, 'right'); ?></title>        <link rel="profile" href="http://gmpg.org/xfn/11" />        <link rel="pingback" href="<?php bloginfo('pingback_url'); ?>" />        <?php // Loads HTML5 JavaScript file to add support for HTML5 elements in older IE versions.  ?>        <!--[if lt IE 9]>        <script src="<?php echo get_template_directory_uri(); ?>/js/html5.js" type="text/javascript"></script>        <![endif]-->        <script src="<?php echo get_template_directory_uri(); ?>/Jcrop/js/jquery.min.js"></script>        <script src="<?php echo get_template_directory_uri(); ?>/Jcrop/js/jquery.Jcrop.js"></script>        <script src="<?php echo get_template_directory_uri(); ?>/Jcrop/js/jquery.color.js"></script>        <link rel="stylesheet" href="<?php echo get_template_directory_uri(); ?>/Jcrop/css/jquery.Jcrop.css" type="text/css" />    </head>    <body >        <?php        global $wpdb, $wp_locale, $wp_query;        $post_id = $_GET['id'];        $resolution = $_GET['resolution'];        $width = current(explode('x', $resolution));        $height = end(explode('x', $resolution));        ?>        <form action="<?php echo get_permalink(get_page_by_path('download')); ?>" method="get" onsubmit="return checkCoords();">            <input type="hidden" id="id" name="f_id" value="<?php echo $post_id ?>" />            <input type="hidden" id="x" name="f_x" />            <input type="hidden" id="y" name="f_y" />            <input type="hidden" id="w" name="f_w" />            <input type="hidden" id="h" name="f_h" />            <input type="submit" value="Crop Image" class="btn btn-large btn-inverse" />        </form>        <?php        if (has_post_thumbnail($post_id)) {            $attr = array(                'id' => "target",                'alt' => "Jcrop Image",            );            echo get_the_post_thumbnail($post_id, 'full', $attr);        }        ?>        <script type="text/javascript">            function checkCoords()            {                if (parseInt($('#w').val()))                    return true;                alert('Please select a crop region then press submit.');                return false;            }            ;            function updateCoords(c)            {                $('#x').val(c.x);                $('#y').val(c.y);                $('#w').val(c.w);                $('#h').val(c.h);            }            jQuery(function($) {                var jcrop_api;                $('#target').Jcrop({                    bgFade: false,                    bgOpacity: .2,                    setSelect: [60, 70, <?php echo $width ?>, <?php echo $height ?>],                    onSelect: updateCoords,                    allowResize: false,                    minSize: [<?php echo $width ?>, <?php echo $height ?>],                    maxSize: [<?php echo $width ?>, <?php echo $height ?>]                }, function() {                    jcrop_api = this;                });                // Define page sections                var sections = {                    bgc_buttons: 'Change bgColor',                    bgo_buttons: 'Change bgOpacity',                    anim_buttons: 'Animate Selection'                };                // Define animation buttons                var ac = {                    anim1: [217, 122, 382, 284],                    anim2: [20, 20, 580, 380],                    anim3: [24, 24, 176, 376],                    anim4: [347, 165, 550, 355],                    anim5: [136, 55, 472, 183]                };                // Define bgOpacity buttons                var bgo = {                    Low: .2,                    Mid: .5,                    High: .8,                    Full: 1                };                // Define bgColor buttons                var bgc = {                    R: '#900',                    B: '#4BB6F0',                    Y: '#F0B207',                    G: '#46B81C',                    W: 'white',                    K: 'black'                };                // Create fieldset targets for buttons                for (i in sections)                    insertSection(i, sections[i]);                function create_btn(c) {                    var $o = $('<button />').addClass('btn btn-small');                    if (c)                        $o.append(c);                    return $o;                }                var a_count = 1;                // Create animation buttons                for (i in ac) {                    $('#anim_buttons .btn-group')                            .append(                            create_btn(a_count++).click(animHandler(ac[i])),                            ' '                            );                }                $('#anim_buttons .btn-group').append(                        create_btn('Bye!').click(function(e) {                    $(e.target).addClass('active');                    jcrop_api.animateTo(                            [300, 200, 300, 200],                            function() {                                this.release();                                $(e.target).closest('.btn-group').find('.active').removeClass('active');                            }                    );                    return false;                })                        );                // Create bgOpacity buttons                for (i in bgo) {                    $('#bgo_buttons .btn-group').append(                            create_btn(i).click(setoptHandler('bgOpacity', bgo[i])),                            ' '                            );                }                // Create bgColor buttons                for (i in bgc) {                    $('#bgc_buttons .btn-group').append(                            create_btn(i).css({                        background: bgc[i],                        color: ((i == 'K') || (i == 'R')) ? 'white' : 'black'                    }).click(setoptHandler('bgColor', bgc[i])), ' '                            );                }                // Function to insert named sections into interface                function insertSection(k, v) {                    $('#interface').prepend(                            $('<fieldset></fieldset>').attr('id', k).append(                            $('<legend></legend>').append(v),                            '<div class="btn-toolbar"><div class="btn-group"></div></div>'                            )                            );                }                ;                // Handler for option-setting buttons                function setoptHandler(k, v) {                    return function(e) {                        $(e.target).closest('.btn-group').find('.active').removeClass('active');                        $(e.target).addClass('active');                        var opt = {};                        opt[k] = v;                        jcrop_api.setOptions(opt);                        return false;                    };                }                ;                // Handler for animation buttons                function animHandler(v) {                    return function(e) {                        $(e.target).addClass('active');                        jcrop_api.animateTo(v, function() {                            $(e.target).closest('.btn-group').find('.active').removeClass('active');                        });                        return false;                    };                }                ;                $('#bgo_buttons .btn:first,#bgc_buttons .btn:last').addClass('active');                $('#interface').show();            });        </script>    </body></html>